<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>TIFFY Earnings Transfer</title>
  <style>
    body {
      background: #000014;
      color: #4af0f8;
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      padding-top: 60px;
    }
    #container {
      max-width: 400px;
      margin: auto;
      padding: 20px;
      background: linear-gradient(145deg, #000000, #0a0a2a);
      border: 2px solid #4af0f8;
      border-radius: 20px;
      box-shadow: 0 0 30px #4af0f8, inset 0 0 15px #4af0f8;
      animation: pulseGlow 3s infinite ease-in-out;
    }
    @keyframes pulseGlow {
      0% { box-shadow: 0 0 15px #4af0f8, inset 0 0 5px #4af0f8; }
      50% { box-shadow: 0 0 40px #4af0f8, inset 0 0 20px #4af0f8; }
      100% { box-shadow: 0 0 15px #4af0f8, inset 0 0 5px #4af0f8; }
    }
    button {
      background: #ff00aa;
      color: white;
      padding: 12px 25px;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      margin-top: 15px;
      cursor: pointer;
      box-shadow: 0 0 15px #ff00aa;
      animation: pulseButton 1.5s infinite alternate;
    }
    @keyframes pulseButton {
      0% { box-shadow: 0 0 10px #ff00aa; }
      100% { box-shadow: 0 0 25px #ff00aa; }
    }
  </style>
</head>
<body>

  <div id="container">
    <h2>Withdrawable Amount</h2>
    <div>
      <strong id="tiffyCount">0 TIFFY</strong> → $<span id="usdValue">0.00</span>
    </div>
    <button id="transferBtn">Transfer Earnings</button>
  </div>

  <script>
    const account = window.account || "guest"; // Replace with actual wallet address if available
    const claimsKey = `tiffyClaimed_${account}`;
    const tetrusKey = "tetrusScore";
    const PRICE_JSON_PATH = "/TIFFY-Market-Value/price.json";

    async function updateDisplay() {
      const claimedTIFFY = parseInt(localStorage.getItem(claimsKey) || "0");
      const tetrusScore = parseInt(localStorage.getItem(tetrusKey) || "0");
      const totalTIFFY = claimedTIFFY + tetrusScore;

      document.getElementById("tiffyCount").textContent = `${totalTIFFY} TIFFY`;

      try {
        const resp = await fetch(PRICE_JSON_PATH, { cache: "no-store" });
        const data = await resp.json();
        const priceUSD = parseFloat(data.tiffyToUSD);
        document.getElementById("usdValue").textContent = (totalTIFFY * priceUSD).toFixed(2);
      } catch (err) {
        console.error("Price fetch failed:", err);
      }
    }

    document.getElementById("transferBtn").addEventListener("click", () => {
      const claimedTIFFY = parseInt(localStorage.getItem(claimsKey) || "0");
      const tetrusScore = parseInt(localStorage.getItem(tetrusKey) || "0");

      const newTotal = claimedTIFFY + tetrusScore;
      localStorage.setItem(claimsKey, newTotal);
      localStorage.setItem(tetrusKey, 0);

      updateDisplay();
      alert("✅ Earnings transferred to your withdrawable balance!");
    });

    document.addEventListener("DOMContentLoaded", updateDisplay);
  </script>

</body>
</html>
