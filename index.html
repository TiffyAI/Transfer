<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<title>Transfer Tetris Earnings to TIFFY</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
<script src="https://unpkg.com/web3modal@1.9.12/dist/index.js"></script>
<style>
  body{background:#000;color:#0ff;font-family:sans-serif;text-align:center;padding:20px}
  h1{text-shadow:0 0 10px #0ff}
  .card{background:rgba(0,0,0,0.6);padding:20px;border:1px solid #0ff;border-radius:12px;display:inline-block;box-shadow:0 0 20px #0ff;margin-top:20px}
  .btn{margin-top:20px;padding:12px 25px;font-size:16px;border:none;border-radius:8px;cursor:pointer}
  .transfer{background:hotpink;color:#fff;box-shadow:0 0 15px hotpink;animation:pulse 1.5s infinite}
  @keyframes pulse{0%{box-shadow:0 0 10px hotpink}50%{box-shadow:0 0 30px hotpink}100%{box-shadow:0 0 10px hotpink}}
</style>
</head>
<body>

<h1>ðŸŽ® Transfer Tetris Earnings</h1>
<button id="connectBtn">Connect Wallet</button>

<div class="card" id="transferCard" style="display:none">
  <div><strong>Wallet:</strong> <span id="walletAddress"></span></div>
  <div><strong>Claimed TIFFY:</strong> <span id="claimed">0</span></div>
  <div><strong>Tetris Earnings:</strong> <span id="tetris">0</span></div>
  <div style="margin-top:10px;font-size:18px"><strong>Total Withdrawable:</strong> <span id="total">0</span></div>
  <button class="btn transfer" id="transferBtn" style="display:none">Transfer Now</button>
</div>

<script>
(async ()=>{
  let web3, provider, account;

  const wModal = new Web3Modal.default({
    cacheProvider:false,
    providerOptions:{
      walletconnect:{package:window.WalletConnectProvider?.default||{}, options:{ rpc:{56:"https://bsc-dataseed.binance.org/"}}}
    }
  });

  document.getElementById("connectBtn").onclick = async() => {
    provider = await wModal.connect();
    web3 = new Web3(provider);

    const cid = await web3.eth.getChainId();
    if(cid !== 56){
      try { 
        await provider.request({ method:"wallet_switchEthereumChain", params:[{chainId:"0x38"}] });
      }
      catch(e){
        if(provider.isBitget || provider.isBitKeep){
          try { 
            await provider.request({ method:"wallet_addEthereumChain", params:[{chainId:"0x38",chainName:"BNB Smart Chain",rpcUrls:["https://bsc-dataseed.binance.org/"],nativeCurrency:{name:"BNB",symbol:"BNB",decimals:18},blockExplorerUrls:["https://bscscan.com"]}]});
          }
          catch{
            alert("ðŸŒ Bitget: please switch BSC manually.");
            return;
          }
        } else { 
          alert("â— Please switch to BNB Smart Chain"); 
          return; 
        }
      }
    }

    const accts = await web3.eth.getAccounts();
    account = accts[0];

    document.getElementById("walletAddress").textContent = account;
    document.getElementById("connectBtn").style.display = "none";
    document.getElementById("transferCard").style.display = "inline-block";
    loadBalances();
  };

  function getClaimed(){
    return parseInt(localStorage.getItem(`tiffyClaimed_${account}`) || "0");
  }

  function getTetris(){
    return parseInt(localStorage.getItem("tetrusScore") || "0");
  }

  function loadBalances(){
    const claimed = getClaimed();
    const tetris = getTetris();
    document.getElementById("claimed").textContent = claimed;
    document.getElementById("tetris").textContent = tetris;
    document.getElementById("total").textContent = claimed + tetris;
    document.getElementById("transferBtn").style.display = tetris > 0 ? "inline-block" : "none";
  }

  document.getElementById("transferBtn").onclick = () => {
    const claimedKey = `tiffyClaimed_${account}`;
    const claimed = getClaimed();
    const tetris = getTetris();
    const newTotal = claimed + tetris;

    localStorage.setItem(claimedKey, newTotal);
    localStorage.setItem("tetrusScore", "0");

    loadBalances();
    alert(`âœ… Transferred ${tetris} Tetris earnings to TIFFY!`);
  };

})();
</script>

</body>
</html>
